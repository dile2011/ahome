//
//  AFamilyHomesController.m
//  ahome
//
//  Created by dilei liu on 15/6/20.
//  Copyright (c) 2015å¹´ ushome. All rights reserved.
//

#import "AFamilyHomesController.h"
#import "UIImageView+WebCache.h"
#import "AHome.h"

@implementation AFamilyHomesController

- (id)initWithPushStyle:(BOOL)isPush family:(id)family selectedIndex:(NSUInteger)selectedIndex {
    self = [super initWithPushStyle:isPush];
    _family = family;
    _selectedIndex = selectedIndex;
    
    return self;
}

- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    
    CGRect frame = CGRectMake(([UIScreen mainScreen].bounds.size.width-_photoView.image.size.width)/2., ([UIScreen mainScreen].bounds.size.height - _photoView.image.size.height)/2.-64, _photoView.image.size.width, _photoView.image.size.height);
    [_photoView setFrame:frame];
    
}

- (void)viewDidLoad {
    [super viewDidLoad];
    self.title = _family.familyCategory;
    
    [self.navigationController.navigationBar setBackgroundImage:[UIImage imageNamed:@"family_navi_background.jpeg"]forBarPosition:UIBarPositionAny barMetrics:UIBarMetricsDefault];
    [self.navigationController.navigationBar setShadowImage:[UIImage new]];
    
    UIImageView *homeBgView = [[UIImageView alloc]initWithFrame:CGRectMake(0, 0, self.view.frame.size.width, self.view.frame.size.height)];
    [homeBgView setImage:[UIImage imageNamed:@"family_home_bg.jpeg"]];
    [self.view addSubview:homeBgView];
    
    _photoView = [[UIImageView alloc]init];
    [homeBgView addSubview:_photoView];
    
    AHome *home = [_family.homes objectAtIndex:_selectedIndex];
    [[SDWebImageManager sharedManager]downloadWithURL:[NSURL URLWithString:home.photo] options:0 progress:^(NSUInteger receivedSize, long long expectedSize) {
        
    } completed:^(UIImage *image, NSError *error, SDImageCacheType cacheType, BOOL finished) {
        UIImage *scalImage = [[AUtilities sharedInstance]compressImage:image fixedWidth:[UIScreen mainScreen].bounds.size.width];
        [_photoView setImage:scalImage];
    }];
}

- (void)leftButtonAction {
    [self.navigationController dismissViewControllerAnimated:NO completion:^{}];
}

@end
